const t={x:0,y:0};function e({x:t,y:e}){return Math.hypot(t,e)}function n({x:t,y:e}){return Math.atan2(e,t)}function i(...e){if(e.length>1){const[t,...n]=e;const{x:r,y:o}=i(...n);return{x:t.x+r,y:t.y+o}}else if(e.length===1){return e[0]}else{return t}}function r(t,e){return{x:t.x-e.x,y:t.y-e.y}}function o({x:t,y:e},n){return{x:t*n,y:e*n}}function s(...t){return o(i(...t),.5)}function h(t){return{x:t.clientX,y:t.clientY}}function a({top:t,left:e}){return{x:e,y:t}}function c({a:t,b:e,c:n,d:i,tx:r,ty:o}){const s=t*i-e*n;return{a:i/s,b:-e/s,c:-n/s,d:t/s,tx:(-i*r+e*o)/s,ty:(n*r-t*o)/s}}function p(...t){if(t.length>1){const[{a:e,b:n,c:i,d:r,tx:o,ty:s},...h]=t;const a=p(...h);return{a:e*a.a+n*a.c,b:e*a.b+n*a.d,c:i*a.a+r*a.c,d:i*a.b+r*a.d,tx:e*a.tx+n*a.ty+o,ty:i*a.tx+r*a.ty+s}}else if(t.length===1){return t[0]}else{return d}}function l({a:t,b:e,c:n,d:i,tx:r,ty:o},{x:s,y:h}){return{x:t*s+e*h+r,y:n*s+i*h+o}}const d={a:1,b:0,c:0,d:1,tx:0,ty:0};function x({a:t,b:e,c:n,d:i,tx:r,ty:o}){return[t,n,e,i,r,o]}function u({scale:t=1,rotate:e=0,translateX:n=0,translateY:i=0}={}){const r=e===0?1:Math.cos(e);const o=e===0?0:Math.sin(e);return{a:t*r,b:t*o,c:-t*o,d:t*r,tx:n,ty:i}}function f(t){return u({scale:t})}function y({x:t,y:e}){return u({translateX:t,translateY:e})}class v{#t;#e=null;#n;constructor(t,e){this.#t=t;this.#n=e;this.#t.addEventListener("pointerdown",this.#i);this.#t.addEventListener("pointermove",this.#r);this.#t.addEventListener("pointerup",this.#o);this.#t.addEventListener("pointercancel",this.#o);this.#t.addEventListener("wheel",this.#s)}#h(t){return r(t,a(this.#t.getBoundingClientRect()))}#i=t=>{const e=h(t);const n={id:t.pointerId,init:e,last:e};if(this.#e){if(this.#e.other){return}this.#e={...this.#e,init:this.#e.last,transformation:this.#n.get(),other:n}}else{this.#e={...n,transformation:this.#n.get(),other:null}}this.#t.setPointerCapture(t.pointerId)};#r=t=>{const i=this.#e;if(i?.id===t.pointerId||i?.other?.id===t.pointerId){if(i.other?.id===t.pointerId){i.other.last=h(t)}else{i.last=h(t)}if(i.other){const t=r(i.init,i.other.init);const o=r(i.last,i.other.last);const h=n(o)-n(t);const a=e(o)/e(t);const c=s(i.last,i.other.last);const l=r(c,s(i.init,i.other.init));const d=this.#h(c);this.#n.set(p(y(d),u({scale:a,rotate:-h}),y(r(l,d)),i.transformation))}else{this.#n.set(p(y(r(i.last,i.init)),i.transformation))}}};#o=t=>{if(this.#e?.id===t.pointerId){if(this.#e.other){this.#e={...this.#e.other,init:this.#e.other.last,transformation:this.#n.get(),other:null}}else{this.#e=null}}else if(this.#e?.other?.id===t.pointerId){this.#e.init=this.#e.last;this.#e.transformation=this.#n.get();this.#e.other=null}};#s=t=>{const e=this.#h(h(t));this.#n.set(p(y(e),f(1.001**-t.deltaY),y(o(e,-1)),this.#n.get()))};destroy(){this.#t.removeEventListener("pointerdown",this.#i);this.#t.removeEventListener("pointermove",this.#r);this.#t.removeEventListener("pointerup",this.#o);this.#t.removeEventListener("pointercancel",this.#o);this.#t.removeEventListener("wheel",this.#s)}}function w(t="Non-nullish value"){throw new TypeError(`${t} expected.`)}function m(t){let e=Infinity;let n=-Infinity;for(const i of t){if(i<e){e=i}if(i>n){n=i}}return{min:e,max:n}}class g{min;max;constructor(t,e){this.min=t;this.max=e}contains({x:t,y:e}){return this.min.x<=t&&t<this.max.x&&this.min.y<=e&&e<this.max.y}corners(){return[this.min,{x:this.min.x,y:this.max.y},{x:this.max.x,y:this.min.y},this.max]}static topLeft(e,n){return new g(t,{x:e,y:n})}static centered(t,e){return new g({x:-t/2,y:-e/2},{x:t/2,y:e/2})}}function*b(t,e){yield[t,e];const n=r(e,t);const o={x:-n.y,y:n.x};const s=i(e,o);yield[e,s];const h=i(t,o);yield[s,h];yield[h,t]}function E(t,e,n,i,r){const o=(i-t[n])/(e[n]-t[n]);if(o<0||o>1){return false}const s=n==="x"?"y":"x";const h=t[s]+o*(e[s]-t[s]);return 0<=h&&h<=r}function M(t,e,n){const i=g.topLeft(e.width,e.height);const r=c(t);const o=i.corners().map((t=>l(r,t)));const{min:s,max:h}=m(o.map((({x:t})=>t)));const{min:a,max:p}=m(o.map((({y:t})=>t)));function d(t,n){for(const[i,r]of b(t,n)){if(E(i,r,"x",0,e.height)||E(i,r,"x",e.width,e.height)||E(i,r,"y",0,e.width)||E(i,r,"y",e.height,e.width)){return true}}return false}const x=[];const u=Math.floor(s/n);const f=Math.floor(h/n)+1;const y=Math.floor(a/n);const v=Math.floor(p/n)+1;for(let e=u;e<f;e++){const r=e*n;for(let e=y;e<v;e++){const o=e*n;const s=l(t,{x:r,y:o});if(i.contains(s)||d(l(t,{x:r,y:o}),l(t,{x:r+n,y:o}))){x.push({x:r,y:o})}}}return x}class P{static MIN_ZOOM=11;static MAX_ZOOM=20;#a;#c;#p;#l;view=d;options;constructor(t,{highQuality:e=true}={}){this.#a=document.createElement("canvas");t.append(this.#a);this.#c=this.#a.getContext("2d")??w("Canvas context");this.#p=new ResizeObserver(this.#d);this.#p.observe(t);this.options={highQuality:e}}#d=([{borderBoxSize:[{blockSize:t,inlineSize:e}]}])=>{if(this.options.highQuality){this.#a.width=e*window.devicePixelRatio;this.#a.height=t*window.devicePixelRatio;this.#c.scale(window.devicePixelRatio,window.devicePixelRatio)}else{this.#a.width=e;this.#a.height=t}this.#l={width:e,height:t};this.render()};render(){this.#c.clearRect(0,0,this.#l.width,this.#l.height);this.#c.save();this.#c.transform(...x(this.view));this.#c.strokeStyle="green";this.#c.fillStyle="rgba(0, 255, 255, 0.1)";this.#c.lineWidth=4;for(const{x:t,y:e}of M(this.view,this.#l,256)){this.#c.fillRect(t,e,256,256);this.#c.strokeRect(t,e,256,256)}this.#c.restore()}destroy(){this.#p.disconnect();this.#a.remove()}}const L=document.getElementById("map")??w("Map wrapper");const z=new P(L);new v(L,{get:()=>z.view,set(t){z.view=t;z.render()}});Object.assign(window,{view:z});
