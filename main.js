const t={x:0,y:0};function e({x:t,y:e}){return Math.hypot(t,e)}function n({x:t,y:e}){return Math.atan2(e,t)}function i(...e){if(e.length>1){const[t,...n]=e;const{x:r,y:s}=i(...n);return{x:t.x+r,y:t.y+s}}else if(e.length===1){return e[0]}else{return t}}function r(t,e){return{x:t.x-e.x,y:t.y-e.y}}function s({x:t,y:e},n){return{x:t*n,y:e*n}}function o(...t){return s(i(...t),.5)}function a({x:t,y:e},n){return{x:n(t),y:n(e)}}function h(t){return{x:t.clientX,y:t.clientY}}function c({top:t,left:e}){return{x:e,y:t}}function l({a:t,b:e,c:n,d:i,tx:r,ty:s}){const o=t*i-e*n;return{a:i/o,b:-e/o,c:-n/o,d:t/o,tx:(-i*r+e*s)/o,ty:(n*r-t*s)/o}}function p(...t){if(t.length>1){const[{a:e,b:n,c:i,d:r,tx:s,ty:o},...a]=t;const h=p(...a);return{a:e*h.a+n*h.c,b:e*h.b+n*h.d,c:i*h.a+r*h.c,d:i*h.b+r*h.d,tx:e*h.tx+n*h.ty+s,ty:i*h.tx+r*h.ty+o}}else if(t.length===1){return t[0]}else{return u}}function d({a:t,b:e,c:n,d:i,tx:r,ty:s},{x:o,y:a}){return{x:t*o+e*a+r,y:n*o+i*a+s}}function f({a:t,b:e,c:n,d:i}){return t*i-e*n}const u={a:1,b:0,c:0,d:1,tx:0,ty:0};function y({a:t,b:e,c:n,d:i,tx:r,ty:s}){return[t,n,e,i,r,s]}function x(t){return`matrix(${y(t).join(", ")})`}function m({scale:t=1,rotate:e=0,translateX:n=0,translateY:i=0}={}){const r=e===0?1:Math.cos(e);const s=e===0?0:Math.sin(e);return{a:t*r,b:-t*s,c:t*s,d:t*r,tx:n,ty:i}}function w(t){return m({scale:t})}function v(t){return m({rotate:t})}function g({x:t,y:e}){return m({translateX:t,translateY:e})}class M{#t;#e=null;#n;options;constructor(t,e){this.#t=t;this.#n=e;this.#t.addEventListener("pointerdown",this.#i);this.#t.addEventListener("pointermove",this.#r);this.#t.addEventListener("pointerup",this.#s);this.#t.addEventListener("pointercancel",this.#s);this.#t.addEventListener("wheel",this.#o);const{scrollMode:n=false}=e;this.options={scrollMode:n}}#a(t){return r(t,c(this.#t.getBoundingClientRect()))}#i=t=>{const e=h(t);const n={id:t.pointerId,init:e,last:e};if(this.#e){if(this.#e.other){return}this.#e={...this.#e,init:this.#e.last,transformation:this.#n.get(),other:n}}else{this.#e={...n,transformation:this.#n.get(),other:null}}this.#t.setPointerCapture(t.pointerId)};#r=t=>{const i=this.#e;if(i?.id===t.pointerId||i?.other?.id===t.pointerId){if(i.other?.id===t.pointerId){i.other.last=h(t)}else{i.last=h(t)}if(i.other){const t=r(i.init,i.other.init);const s=r(i.last,i.other.last);const a=n(s)-n(t);const h=e(s)/e(t);const c=o(i.last,i.other.last);const l=r(c,o(i.init,i.other.init));const d=this.#a(c);this.#n.set(p(g(d),m({scale:h,rotate:a}),g(r(l,d)),i.transformation))}else{this.#n.set(p(g(r(i.last,i.init)),i.transformation))}}};#s=t=>{if(this.#e?.id===t.pointerId){if(this.#e.other){this.#e={...this.#e.other,init:this.#e.other.last,transformation:this.#n.get(),other:null}}else{this.#e=null}}else if(this.#e?.other?.id===t.pointerId){this.#e.init=this.#e.last;this.#e.transformation=this.#n.get();this.#e.other=null}};#o=t=>{const e=this.#a(h(t));if(!this.options.scrollMode||t.ctrlKey&&!t.shiftKey){this.#n.set(p(g(e),w(1.001**-t.deltaY),g(s(e,-1)),this.#n.get()))}else if(t.ctrlKey&&t.shiftKey){this.#n.set(p(g(e),v(t.deltaY*.001),g(s(e,-1)),this.#n.get()))}else{this.#n.set(p(g({x:t.shiftKey?-t.deltaY:-t.deltaX,y:t.shiftKey?0:-t.deltaY}),this.#n.get()))}t.preventDefault()};destroy(){this.#t.removeEventListener("pointerdown",this.#i);this.#t.removeEventListener("pointermove",this.#r);this.#t.removeEventListener("pointerup",this.#s);this.#t.removeEventListener("pointercancel",this.#s);this.#t.removeEventListener("wheel",this.#o)}}function b(t="Non-nullish value"){throw new TypeError(`${t} expected.`)}function E(t){let e=Infinity;let n=-Infinity;for(const i of t){if(i<e){e=i}if(i>n){n=i}}return{min:e,max:n}}function I(t,e){return(t%e+e)%e}class L{min;max;constructor(t,e){this.min=t;this.max=e}contains({x:t,y:e}){return this.min.x<=t&&t<this.max.x&&this.min.y<=e&&e<this.max.y}corners(){return[this.min,{x:this.min.x,y:this.max.y},{x:this.max.x,y:this.min.y},this.max]}static topLeft(e,n){return new L(t,{x:e,y:n})}static centered(t,e){return new L({x:-t/2,y:-e/2},{x:t/2,y:e/2})}}function*P(t,e){yield[t,e];const n=r(e,t);const s={x:-n.y,y:n.x};const o=i(e,s);yield[e,o];const a=i(t,s);yield[o,a];yield[a,t]}function k(t,e,n,i,r){const s=(i-t[n])/(e[n]-t[n]);if(s<0||s>1){return false}const o=n==="x"?"y":"x";const a=t[o]+s*(e[o]-t[o]);return 0<=a&&a<=r}function O(t,e,n,i){const r=a(t.origin,(t=>-I(t,i)));const s=a(t.origin,(t=>Math.floor(t/i)));const o=L.topLeft(n.width,n.height);const h=l(e);const c=o.corners().map((t=>d(h,t)));const{min:p,max:f}=E(c.map((({x:t})=>t-r.x)));const{min:u,max:y}=E(c.map((({y:t})=>t-r.y)));function x(t,e){for(const[i,r]of P(t,e)){if(k(i,r,"x",0,n.height)||k(i,r,"x",n.width,n.height)||k(i,r,"y",0,n.width)||k(i,r,"y",n.height,n.width)){return true}}return false}const m=[];const w=Math.floor(p/i);const v=Math.floor(f/i)+1;const g=Math.floor(u/i);const M=Math.floor(y/i)+1;for(let t=w;t<v;t++){const n=t*i+r.x;for(let a=g;a<M;a++){const h=a*i+r.y;const c=d(e,{x:n,y:h});if(o.contains(c)||x(d(e,{x:n,y:h}),d(e,{x:n+i,y:h}))){m.push({position:{x:n,y:h},tile:{x:t+s.x,y:-1-a-s.y}})}}}return m}const $=2**(7+20);function z(t,e){return{x:$*(e/180+1),y:-$*(Math.log(Math.tan(Math.PI/4+t*Math.PI/360))/Math.PI+1)}}const W=z(32.877341347399,-117.23531663418);const _={origin:W};const S=["https://assets.concept3d.com/assets/1005/1005_Map_8/","https://assets.concept3d.com/assets/1005/1005_Labels_5/"];class X{static MIN_ZOOM=11;static MAX_ZOOM=20;#h=document.createElement("div");#c=new ResizeObserver(((...t)=>this.#l(...t)));#p={width:0,height:0};#d=[];view=u;options;constructor(t,{}={}){for(const t of S){const e={host:t,wrapper:document.createElement("div"),images:new Map,markers:new Map,keep:new Set};this.#d.push(e);this.#h.append(e.wrapper)}this.#h.classList.add("transformation-wrapper");t.append(this.#h);this.#c.observe(t);this.options={}}#l=([{borderBoxSize:[{blockSize:t,inlineSize:e}]}])=>{this.view.tx+=e/2-this.#p.width/2;this.view.ty+=t/2-this.#p.height/2;this.#p={width:e,height:t};this.render()};#f(t,e,n,i,r){const s=`${e}/${r.x}/${r.y}`;t.keep.add(s);let o=t.images.get(s);if(!o){o=document.createElement("img");o.style.left=`${n.x}px`;o.style.top=`${n.y}px`;o.width=i;o.height=i;o.draggable=false;o.src=t.host+s;t.images.set(s,o);let r=t.markers.get(e);if(r){r.after(o)}else{let n=e;while(!r&&n<X.MAX_ZOOM){n++;r=t.markers.get(n)}if(r){r.before(o)}else{t.wrapper.append(o)}t.markers.set(e,o)}}if(!o.complete){let n=e;let i=r;while(n>X.MIN_ZOOM){n--;i=a(i,(t=>Math.floor(t/2)));t.keep.add(`${n}/${i.x}/${i.y}`)}if(e<X.MAX_ZOOM){for(let n=0;n<2;n++){for(let i=0;i<2;i++){t.keep.add(`${e+1}/${r.x*2+n}/${r.y*2+i}`)}}}}}render(){this.#h.style.transform=x(this.view);const t=Math.max(Math.floor(-Math.log2(f(this.view))/2),0);const e=2**t*256;for(const{position:n,tile:i}of O(_,this.view,this.#p,e)){for(const r of this.#d){this.#f(r,X.MAX_ZOOM-t,n,e,i)}}for(const t of this.#d){const e=new Set(t.markers.values());for(const[n,i]of t.images){if(!t.keep.has(n)){if(e.has(i)){const r=i.nextElementSibling instanceof HTMLImageElement?i.nextElementSibling:null;const s=parseInt(n);if(!r||e.has(r)){t.markers.delete(s)}else{t.markers.set(s,r);e.add(r)}}i.remove();t.images.delete(n)}}t.keep=new Set}}destroy(){this.#c.disconnect()}}const Y=document.getElementById("map")??b("Map wrapper");const K=new X(Y);K.view=m({scale:.25});const Z=new M(Y,{get:()=>K.view,set(t){K.view=t;K.render()},scrollMode:false});Object.assign(window,{view:K,interactive:Z});
