const t={x:0,y:0};function e({x:t,y:e}){return Math.hypot(t,e)}function i({x:t,y:e}){return Math.atan2(e,t)}function n(...e){if(e.length>1){const[t,...i]=e;const{x:s,y:r}=n(...i);return{x:t.x+s,y:t.y+r}}else if(e.length===1){return e[0]}else{return t}}function s(t,e){return{x:t.x-e.x,y:t.y-e.y}}function r({x:t,y:e},i){return{x:t*i,y:e*i}}function o(...t){return r(n(...t),.5)}function a({x:t,y:e},i){return{x:i(t),y:i(e)}}function h(t){return{x:t.clientX,y:t.clientY}}function c({top:t,left:e}){return{x:e,y:t}}function d({a:t,b:e,c:i,d:n,tx:s,ty:r}){const o=t*n-e*i;return{a:n/o,b:-e/o,c:-i/o,d:t/o,tx:(-n*s+e*r)/o,ty:(i*s-t*r)/o}}function l(...t){if(t.length>1){const[{a:e,b:i,c:n,d:s,tx:r,ty:o},...a]=t;const h=l(...a);return{a:e*h.a+i*h.c,b:e*h.b+i*h.d,c:n*h.a+s*h.c,d:n*h.b+s*h.d,tx:e*h.tx+i*h.ty+r,ty:n*h.tx+s*h.ty+o}}else if(t.length===1){return t[0]}else{return f}}function p({a:t,b:e,c:i,d:n,tx:s,ty:r},{x:o,y:a}){return{x:t*o+e*a+s,y:i*o+n*a+r}}function u({a:t,b:e,c:i,d:n}){return t*n-e*i}const f={a:1,b:0,c:0,d:1,tx:0,ty:0};function x({a:t,b:e,c:i,d:n,tx:s,ty:r}){return[t,i,e,n,s,r]}function y({scale:t=1,rotate:e=0,translateX:i=0,translateY:n=0}={}){const s=e===0?1:Math.cos(e);const r=e===0?0:Math.sin(e);return{a:t*s,b:-t*r,c:t*r,d:t*s,tx:i,ty:n}}function v(t){return y({scale:t})}function w(t){return y({rotate:t})}function m({x:t,y:e}){return y({translateX:t,translateY:e})}class g{#t;#e=null;#i;options;constructor(t,e){this.#t=t;this.#i=e;this.#t.addEventListener("pointerdown",this.#n);this.#t.addEventListener("pointermove",this.#s);this.#t.addEventListener("pointerup",this.#r);this.#t.addEventListener("pointercancel",this.#r);this.#t.addEventListener("wheel",this.#o);const{scrollMode:i=false}=e;this.options={scrollMode:i}}#a(t){return s(t,c(this.#t.getBoundingClientRect()))}#n=t=>{const e=h(t);const i={id:t.pointerId,init:e,last:e};if(this.#e){if(this.#e.other){return}this.#e={...this.#e,init:this.#e.last,transformation:this.#i.get(),other:i}}else{this.#e={...i,transformation:this.#i.get(),other:null}}this.#t.setPointerCapture(t.pointerId)};#s=t=>{const n=this.#e;if(n?.id===t.pointerId||n?.other?.id===t.pointerId){if(n.other?.id===t.pointerId){n.other.last=h(t)}else{n.last=h(t)}if(n.other){const t=s(n.init,n.other.init);const r=s(n.last,n.other.last);const a=i(r)-i(t);const h=e(r)/e(t);const c=o(n.last,n.other.last);const d=s(c,o(n.init,n.other.init));const p=this.#a(c);this.#i.set(l(m(p),y({scale:h,rotate:a}),m(s(d,p)),n.transformation))}else{this.#i.set(l(m(s(n.last,n.init)),n.transformation))}}};#r=t=>{if(this.#e?.id===t.pointerId){if(this.#e.other){this.#e={...this.#e.other,init:this.#e.other.last,transformation:this.#i.get(),other:null}}else{this.#e=null}}else if(this.#e?.other?.id===t.pointerId){this.#e.init=this.#e.last;this.#e.transformation=this.#i.get();this.#e.other=null}};#o=t=>{const e=this.#a(h(t));if(!this.options.scrollMode||t.ctrlKey&&!t.shiftKey){this.#i.set(l(m(e),v(1.001**-t.deltaY),m(r(e,-1)),this.#i.get()))}else if(t.ctrlKey&&t.shiftKey){this.#i.set(l(m(e),w(t.deltaY*.001),m(r(e,-1)),this.#i.get()))}else{this.#i.set(l(m({x:t.shiftKey?-t.deltaY:-t.deltaX,y:t.shiftKey?0:-t.deltaY}),this.#i.get()))}t.preventDefault()};destroy(){this.#t.removeEventListener("pointerdown",this.#n);this.#t.removeEventListener("pointermove",this.#s);this.#t.removeEventListener("pointerup",this.#r);this.#t.removeEventListener("pointercancel",this.#r);this.#t.removeEventListener("wheel",this.#o)}}function M(t="Non-nullish value"){throw new TypeError(`${t} expected.`)}function L(t){let e=Infinity;let i=-Infinity;for(const n of t){if(n<e){e=n}if(n>i){i=n}}return{min:e,max:i}}function E(t,e){return(t%e+e)%e}class P{min;max;constructor(t,e){this.min=t;this.max=e}contains({x:t,y:e}){return this.min.x<=t&&t<this.max.x&&this.min.y<=e&&e<this.max.y}corners(){return[this.min,{x:this.min.x,y:this.max.y},{x:this.max.x,y:this.min.y},this.max]}static topLeft(e,i){return new P(t,{x:e,y:i})}static centered(t,e){return new P({x:-t/2,y:-e/2},{x:t/2,y:e/2})}}function*b(t,e){yield[t,e];const i=s(e,t);const r={x:-i.y,y:i.x};const o=n(e,r);yield[e,o];const a=n(t,r);yield[o,a];yield[a,t]}function I(t,e,i,n,s){const r=(n-t[i])/(e[i]-t[i]);if(r<0||r>1){return false}const o=i==="x"?"y":"x";const a=t[o]+r*(e[o]-t[o]);return 0<=a&&a<=s}function z(t,e,i,s){const r=a(t.origin,(t=>-E(t,s)));const o=a(t.origin,(t=>Math.floor(t/s)));const h=P.topLeft(i.width,i.height);const c=d(e);const l=h.corners().map((t=>p(c,t)));const{min:u,max:f}=L(l.map((({x:t})=>t-r.x)));const{min:x,max:y}=L(l.map((({y:t})=>t-r.y)));function v(t,e){for(const[n,s]of b(t,e)){if(I(n,s,"x",0,i.height)||I(n,s,"x",i.width,i.height)||I(n,s,"y",0,i.width)||I(n,s,"y",i.height,i.width)){return true}}return false}const w=[];const m=Math.floor(u/s);const g=Math.floor(f/s)+1;const M=Math.floor(x/s);const z=Math.floor(y/s)+1;for(let t=m;t<g;t++){const i=t*s+r.x;for(let a=M;a<z;a++){const c=a*s+r.y;const d=p(e,{x:i,y:c});if(h.contains(d)||v(p(e,{x:i,y:c}),p(e,{x:i+s,y:c}))){w.push({rendered:{x:i,y:c},tile:n({x:t,y:a},o)})}}}return w}function R(t){const e=new Image;return new Promise(((i,n)=>{e.addEventListener("load",(()=>i(e)));e.addEventListener("error",(()=>n(e)));e.src=t}))}class O{#h;#c;#d=new Map;#l=false;#p=new Set;constructor(t,e){this.#h=t;this.#c=e}#u(t){if(!this.#p.has(t)){if(this.#p.size===0){window.requestAnimationFrame(this.#f)}this.#p.add(t);R(this.#h+t).then((e=>{this.#p.delete(t);this.#d.set(t,e);this.#l=true}))}}request(t){const e=this.#d.get(t);if(e){return e}this.#u(t);return null}#f=()=>{if(this.#l){this.#c();this.#l=false}if(this.#p.size>0){window.requestAnimationFrame(this.#f)}}}const Y=2**(7+20);function C(t,e){return{x:Y*(e/180+1),y:-Y*(Math.log(Math.tan(Math.PI/4+t*Math.PI/360))/Math.PI+1)}}const K=C(32.877341347399,-117.23531663418);const W={origin:K};class X{static MIN_ZOOM=11;static MAX_ZOOM=20;#x=document.createElement("canvas");#y=this.#x.getContext("2d")??M("Canvas context");#v=new ResizeObserver(((...t)=>this.#w(...t)));#m={width:0,height:0};#g=new O("https://assets.concept3d.com/assets/1005/1005_Maps/",(()=>this.render()));view=f;options;constructor(t,{highQuality:e=true}={}){t.append(this.#x);this.#v.observe(t);this.options={highQuality:e}}#w=([{borderBoxSize:[{blockSize:t,inlineSize:e}]}])=>{if(this.options.highQuality){this.#x.width=e*window.devicePixelRatio;this.#x.height=t*window.devicePixelRatio;this.#y.scale(window.devicePixelRatio,window.devicePixelRatio)}else{this.#x.width=e;this.#x.height=t}this.view.tx+=e/2-this.#m.width/2;this.view.ty+=t/2-this.#m.height/2;this.#m={width:e,height:t};this.render()};render(){this.#y.clearRect(0,0,this.#m.width,this.#m.height);this.#y.save();this.#y.transform(...x(this.view));const t=Math.max(Math.floor(-Math.log2(u(this.view))/2),0);const e=2**t*256;for(const{rendered:{x:i,y:n},tile:s}of z(W,this.view,this.#m,e)){const r=this.#g.request(`${X.MAX_ZOOM-t}/${s.x}/${-1-s.y}`);if(r){this.#y.drawImage(r,i,n,e,e)}}this.#y.restore()}destroy(){this.#v.disconnect();this.#x.remove()}}const F=document.getElementById("map")??M("Map wrapper");const q=new X(F);const A=new g(F,{get:()=>q.view,set(t){q.view=t;q.render()},scrollMode:true});Object.assign(window,{view:q,interactive:A});
